<?xml version="1.0" encoding="UTF-8"?>
<project name="jmockit" basedir=".">
   <path id="common.classpath"/>

   <target name="createJavadocs">
      <property name="api" value="../jmockit.github.io/api1x"/>
      <delete dir="${api}" includes="**/*.html" excludes="overview.html" quiet="true"/>
      <delete file="${api}/stylesheet.css"/>
      <javadoc
         destdir="${api}" overview="${api}/overview.html"
         classpathref="common.classpath" classpath="main/target/classes"
         nodeprecated="true" noindex="true" notree="true" nohelp="true" breakiterator="yes"
         windowtitle="JMockit Toolkit API"
         encoding="UTF-8" charset="UTF-8" locale="en">
         <arg line="-notimestamp -quiet -Xdoclint:none"/>
         <fileset dir="${basedir}/main/src">
            <include name="mockit/*.java"/>
            <include name="mockit/integration/junit4/*.java"/>
            <include name="mockit/integration/springframework/*.java"/>
         </fileset>
         <link href="http://docs.oracle.com/javase/8/docs/api/" offline="true" packagelistloc="${api}/javase"/>
         <link href="http://docs.oracle.com/javaee/7/api/"      offline="true" packagelistloc="${api}/javaee"/>
         <doctitle><![CDATA[
            <a href="http://jmockit.github.io" target="_top">
               <img src="resources/logo.png" style="vertical-align:middle">JMockit</a> - API Documentation
         ]]></doctitle>
         <header><![CDATA[
            <a href="http://jmockit.github.io" target="_top">
               <img src="resources/logo.png" style="padding:4px;vertical-align:middle">JMockit Home</a>
         ]]></header>
         <footer><![CDATA[
            <a href="http://jmockit.github.io" target="_top">
               <img src="resources/logo.png" style="padding:4px;vertical-align:middle">JMockit Home</a>
         ]]></footer>
      </javadoc>
      <delete file="${api}/constant-values.html"/>
      <replace dir="${api}/mockit" includes="*.html" token="resources/logo.png" value="../resources/logo.png"/>
      <replace
         dir="${api}/mockit/integration/junit4" includes="*.html"
         token="resources/logo.png" value="../../../resources/logo.png"/>
      <replace
         dir="${api}/mockit/integration/springframework" includes="*.html"
         token="resources/logo.png" value="../../../resources/logo.png"/>
      <replace dir="${api}" includes="*.html">
         <replacetoken><![CDATA[</head>]]></replacetoken>
         <replacevalue><![CDATA[<link rel="shortcut icon" type="image/x-icon" href="resources/favicon.ico">
</head>]]></replacevalue>
      </replace>
      <replace dir="${api}/mockit" includes="*.html">
         <replacetoken><![CDATA[</head>]]></replacetoken>
         <replacevalue><![CDATA[<link rel="shortcut icon" type="image/x-icon" href="../resources/favicon.ico">
</head>]]></replacevalue>
      </replace>
      <replace dir="${api}/mockit/integration" includes="*/*.html">
         <replacetoken><![CDATA[</head>]]></replacetoken>
         <replacevalue><![CDATA[<link rel="shortcut icon" type="image/x-icon" href="../../../resources/favicon.ico">
</head>]]></replacevalue>
      </replace>
      <replace file="${api}/stylesheet.css" token=".subNav {" value=".subNavList { display: none; } .subNav {"/>
      <fixcrlf srcdir="${api}" eol="lf" eof="remove" preservelastmodified="true">
         <include name="**/*.html"/>
         <include name="**/*.js"/>
         <include name="**/*.css"/>
         <include name="**/package-list"/>
      </fixcrlf>
   </target>

   <target name="createJar">
      <delete file="jmockit.jar"/>
      <jar destfile="jmockit.jar">
         <fileset file="LICENSE.txt"/>
         <fileset file="NOTICE.txt"/>
         <fileset dir="main/src" includes="mockit/**/*.java **/attach/**/*.java org/junit/**/*.java"/>
         <fileset dir="main/src" includes="**/*.css **/*.js **/*.png"/>
         <fileset dir="main/target/classes" includes="mockit/**/*.class **/attach/**/*.class org/junit/**/*.class"/>
         <manifest>
            <attribute name="Main-Class" value="mockit.coverage.CodeCoverage"/>
            <attribute name="Premain-Class" value="mockit.internal.startup.Startup"/>
            <attribute name="Agent-Class" value="mockit.internal.startup.Startup"/>
            <attribute name="Can-Redefine-Classes" value="true"/>
            <attribute name="Can-Retransform-Classes" value="true"/>
         </manifest>
         <service type="org.junit.platform.engine.TestEngine" provider="mockit.integration.junit5.JMockitTestEngine"/>
         <service type="org.testng.ITestNGListener" provider="mockit.integration.testng.TestNGRunnerDecorator"/>
      </jar>
   </target>
</project>
